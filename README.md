# ç”µå•†æ™ºèƒ½å¯¼è´­Agent
ðŸŽ¯ åŸºäºŽé˜¿é‡Œäº‘ç™¾ç‚¼+LangChain+Neo4jæž„å»ºçš„å¤šè½®ä¼šè¯å¯¼è´­ç³»ç»Ÿï¼Œè¦†ç›–ã€Œéœ€æ±‚æŒ–æŽ˜â†’å•†å“æŽ¨èâ†’å¯¹æ¯”â†’ä¼˜æƒ åŒ¹é…â†’ä¸‹å•å¼•å¯¼ã€å…¨æµç¨‹ï¼Œä¸“ä¸ºAIäº§å“ç»ç†ä½œå“é›†è®¾è®¡ï¼Œçªå‡ºæµç¨‹é—­çŽ¯ä¸Žæ•°æ®é©±åŠ¨èƒ½åŠ›ã€‚

## é¡¹ç›®äº®ç‚¹
### 1. æ ¸å¿ƒåŠŸèƒ½é—­çŽ¯
| åŠŸèƒ½æ¨¡å— | æ ¸å¿ƒèƒ½åŠ› | åœºæ™¯ç¤ºä¾‹ |
|----------|----------|----------|
| éœ€æ±‚æ¾„æ¸… | æ¨¡ç³Šéœ€æ±‚è‡ªåŠ¨è¿½é—®ï¼ˆé¢„ç®—/è‚¤è´¨/ä½¿ç”¨åœºæ™¯ï¼‰ | è¾“å…¥ã€Œä¹°å£çº¢ã€â†’ è¿½é—®ã€Œé¢„ç®—èŒƒå›´+å”‡éƒ¨çŠ¶æ€ã€ |
| ç²¾å‡†æŽ¨è | åŸºäºŽç»“æž„åŒ–æ•°æ®çš„å•†å“æ£€ç´¢ | è¾“å…¥ã€Œ300å…ƒå†…å¹²ç‡¥æµ…å”‡å£çº¢ã€â†’ æŽ¨èåŒ¹é…å•†å“ |
| å•†å“å¯¹æ¯” | æ ¸å¿ƒå‚æ•°å¯è§†åŒ–å¯¹æ¯” | è¾“å…¥ã€Œå£çº¢Kå’ŒLå“ªä¸ªå¥½ã€â†’ ç”Ÿæˆä¼˜ç¼ºç‚¹å¯¹æ¯”è¡¨ |
| ä¼˜æƒ åŒ¹é… | è‡ªåŠ¨åŒ¹é…ä¼˜æƒ åˆ¸+è®¡ç®—æŠ˜åŽä»· | æŽ¨èå•†å“åŽè‡ªåŠ¨æ˜¾ç¤ºã€Œæ»¡200å‡30ã€åŠæŠ˜åŽä»· |
| ä¸‹å•å¼•å¯¼ | å…¨æµç¨‹å¯¼è´­è½¬åŒ– | ç”¨æˆ·ç¡®è®¤è´­ä¹°åŽâ†’å¼•å¯¼åŠ è´­â†’ç»“ç®—â†’é”å®šä¼˜æƒ  |

### 2. æŠ€æœ¯æž¶æž„
```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[Streamlitå‰ç«¯ç•Œé¢]
    B --> C[LangChain Agentæ ¸å¿ƒ]
    C --> D[é˜¿é‡Œäº‘ç™¾ç‚¼å¤§æ¨¡åž‹ï¼ˆqwen-plusï¼‰]
    C --> E[å·¥å…·é“¾è°ƒåº¦]
    E --> F[å•†å“æ£€ç´¢å·¥å…·]
    E --> G[ä¼˜æƒ åˆ¸æŸ¥è¯¢å·¥å…·]
    E --> H[å•†å“å¯¹æ¯”å·¥å…·]
    F --> I[ç»“æž„åŒ–å•†å“æ•°æ®é›†ï¼ˆCSVï¼‰]
    F --> J[Neo4jå•†å“çŸ¥è¯†å›¾è°±]
    G --> I
    H --> I
```
- **å¤§æ¨¡åž‹**ï¼šé˜¿é‡Œäº‘ç™¾ç‚¼ï¼ˆqwen-plusï¼‰- è´Ÿè´£å¤šè½®ä¼šè¯ç†è§£ä¸Žæµç¨‹è°ƒåº¦
- **Agentæ¡†æž¶**ï¼šLangChain - ç®¡ç†å·¥å…·è°ƒç”¨ã€ä¼šè¯è®°å¿†ä¸Žæµç¨‹é€»è¾‘
- **æ•°æ®å­˜å‚¨**ï¼šCSVï¼ˆç»“æž„åŒ–å•†å“æ•°æ®ï¼‰+ Neo4jï¼ˆå•†å“çŸ¥è¯†å›¾è°±ï¼Œå¯é€‰ï¼‰
- **å‰ç«¯å±•ç¤º**ï¼šStreamlit - è½»é‡åŒ–å¯è§†åŒ–å¯¹è¯ç•Œé¢ï¼Œæ”¯æŒå¿«é€Ÿæ¼”ç¤º
- **å·¥å…·é“¾**ï¼šå•†å“æ£€ç´¢ã€ä¼˜æƒ åˆ¸æŸ¥è¯¢ã€å•†å“å¯¹æ¯”ä¸‰å¤§æ ¸å¿ƒå·¥å…·

### 3. äº§å“ä¼˜åŠ¿
- ðŸš€ **æµç¨‹é—­çŽ¯**ï¼šè¦†ç›–å¯¼è´­å…¨é“¾è·¯ï¼Œæ¨¡æ‹ŸçœŸå®žç”µå•†å¯¼è´­æ²Ÿé€šåœºæ™¯
- ðŸ“Š **æ•°æ®å¯æŽ§**ï¼šæ‰€æœ‰å•†å“/ä¼˜æƒ æ•°æ®æ¥è‡ªæœ¬åœ°CSVï¼Œæ— æ¨¡åž‹å¹»è§‰ï¼Œå¯å¤çŽ°
- ðŸŽ¨ **äº¤äº’å‹å¥½**ï¼šå£è¯­åŒ–å›žå¤+emojiå¢žå¼ºï¼Œé™ä½Žç”¨æˆ·æ²Ÿé€šæˆæœ¬
- ðŸ”Œ **ä½Žä»£ç æ‰©å±•**ï¼šæ–°å¢žå“ç±»ä»…éœ€è¡¥å……CSVæ•°æ®ï¼Œæ— éœ€å¤§å¹…ä¿®æ”¹ä»£ç 
- ðŸ“± **å¤šåœºæ™¯é€‚é…**ï¼šæ”¯æŒå£çº¢ã€ç²‰åº•æ¶²ã€é¢éœœç­‰å¤šç¾Žå¦†å“ç±»å¯¼è´­

## å¿«é€Ÿå¯åŠ¨
### 1. çŽ¯å¢ƒå‡†å¤‡
| ä¾èµ–é¡¹ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜Ž |
|--------|----------|------|
| æ“ä½œç³»ç»Ÿ | Windows10/11 | å…¼å®¹ä¸»æµWindowsç³»ç»Ÿ |
| Python | 3.9+ | æŽ¨è3.9ç‰ˆæœ¬ï¼Œå…¼å®¹æ€§æœ€ä½³ |
| ä¾èµ–ç®¡ç† | Anaconda | å¿«é€Ÿåˆ›å»ºéš”ç¦»çŽ¯å¢ƒ |
| å¯é€‰ä¾èµ– | Neo4j 5.x | ç”¨äºŽå•†å“çŸ¥è¯†å›¾è°±åŠŸèƒ½ |
| å¿…è¦å¯†é’¥ | é˜¿é‡Œäº‘ç™¾ç‚¼API Key | å…è´¹é¢åº¦å¯æ»¡è¶³æµ‹è¯•éœ€æ±‚ |

### 2. éƒ¨ç½²æ­¥éª¤
#### æ­¥éª¤1ï¼šå…‹éš†ä»“åº“
```bash
git clone https://github.com/MagicYao/ecommerce_agent.git
cd ecommerce_agent
```

#### æ­¥éª¤2ï¼šåˆ›å»ºå¹¶æ¿€æ´»condaçŽ¯å¢ƒ
```bash
# åˆ›å»ºä¸“å±žçŽ¯å¢ƒ
conda create -n ecommerce_agent python=3.9
# æ¿€æ´»çŽ¯å¢ƒ
conda activate ecommerce_agent
# å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt
```

#### æ­¥éª¤3ï¼šé…ç½®API Key
1. ç™»å½•é˜¿é‡Œäº‘ç™¾ç‚¼æŽ§åˆ¶å°ï¼šhttps://dashscope.console.aliyun.com/
2. è¿›å…¥ã€ŒAPI-KEYç®¡ç†ã€èŽ·å–API Key
3. é…ç½®ç³»ç»ŸçŽ¯å¢ƒå˜é‡ï¼ˆWindowsï¼‰ï¼š
   - å³é”®ã€Œæ­¤ç”µè„‘ã€â†’ã€Œå±žæ€§ã€â†’ã€Œé«˜çº§ç³»ç»Ÿè®¾ç½®ã€â†’ã€ŒçŽ¯å¢ƒå˜é‡ã€
   - æ–°å»ºã€Œç³»ç»Ÿå˜é‡ã€ï¼šå˜é‡å`DASHSCOPE_API_KEY`ï¼Œå€¼ä¸ºä½ çš„API Key
   - é‡å¯ç»ˆç«¯/VSCodeä½¿é…ç½®ç”Ÿæ•ˆ

#### æ­¥éª¤4ï¼šåˆå§‹åŒ–æ•°æ®ï¼ˆæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰
- å•†å“æ•°æ®å·²å†…ç½®åœ¨ `data/product_data.csv`ï¼ŒåŒ…å«12æ¬¾ç¾Žå¦†å•†å“ï¼ˆå£çº¢3æ¬¾+ç²‰åº•æ¶²5æ¬¾+é¢éœœ4æ¬¾ï¼‰
- ï¼ˆå¯é€‰ï¼‰æž„å»ºNeo4jçŸ¥è¯†å›¾è°±ï¼š
  ```bash
  python build_kg.py
  ```
  éœ€å…ˆå®‰è£…Neo4jå¹¶é…ç½® `config.py` ä¸­çš„Neo4jè¿žæŽ¥ä¿¡æ¯ï¼ˆé»˜è®¤æœ¬åœ°åœ°å€ï¼š`bolt://localhost:7687`ï¼‰

#### æ­¥éª¤5ï¼šè¿è¡ŒDemo
```bash
# æ–¹å¼1ï¼šç»ˆç«¯äº¤äº’æµ‹è¯•ï¼ˆå¿«é€ŸéªŒè¯åŠŸèƒ½ï¼‰
python agent.py

# æ–¹å¼2ï¼šStreamlitå¯è§†åŒ–ç•Œé¢ï¼ˆæŽ¨èæ¼”ç¤ºï¼‰
streamlit run app.py
```
- å¯è§†åŒ–ç•Œé¢è®¿é—®åœ°å€ï¼šhttp://localhost:8501ï¼ˆå¯åŠ¨åŽè‡ªåŠ¨æ‰“å¼€ï¼‰

### 3. æµ‹è¯•åœºæ™¯ç¤ºä¾‹
#### åœºæ™¯1ï¼šæ¨¡ç³Šéœ€æ±‚æ¾„æ¸…ä¸Žç²¾å‡†æŽ¨è
```
ç”¨æˆ·ï¼šä¹°å£çº¢
å°æ™ºï¼šä½ çš„é¢„ç®—èŒƒå›´æ˜¯å¤šå°‘å‘€ï¼Ÿï¼ˆå¦‚100-200å…ƒï¼‰ï½ž
è¿˜æœ‰å”‡éƒ¨çŠ¶æ€æ˜¯å¹²ç‡¥è¿˜æ˜¯ä¸å¡çº¹å‘¢ï¼ŸðŸ˜Š

ç”¨æˆ·ï¼š300ä»¥å†…ï¼Œå¹²ç‡¥ï¼Œæµ…å”‡
å°æ™ºï¼šä¸ºä½ æŽ¨èä»¥ä¸‹ç¬¦åˆéœ€æ±‚çš„å£çº¢ï¼š
1. æ»‹æ¶¦ä¿æ¹¿å£çº¢Kï½žåŽŸä»·Â¥199ï¼ŒæŠ˜åŽÂ¥179ï¼ˆæ»¡150å‡20å…ƒï¼‰ï½žä¼˜åŠ¿ï¼šä¿æ¹¿ä¸å¡çº¹ï¼Œé€‚åˆæµ…å”‡ï½ž
2. æµ…å”‡ä¸“ç”¨å£çº¢Lï½žåŽŸä»·Â¥259ï¼ŒæŠ˜åŽÂ¥229ï¼ˆæ»¡200å‡30å…ƒï¼‰ï½žä¼˜åŠ¿ï¼šæµ…å”‡æ˜¾è‰²è‡ªç„¶ï¼Œä¿æ¹¿åŠ›å¼ºï½ž
3. å¤å¤çº¢å£çº¢Iï½žåŽŸä»·Â¥289ï¼ŒæŠ˜åŽÂ¥249ï¼ˆæ»¡250å‡40å…ƒï¼‰ï½žä¼˜åŠ¿ï¼šæ˜¾ç™½ä¸æŒ‘çš®ï¼Œä¸æ‹”å¹²ï½ž

ðŸŽ« å¯ç”¨ä¼˜æƒ åˆ¸æ±‡æ€»ï¼š
- æ»‹æ¶¦ä¿æ¹¿å£çº¢Kï¼šæ»¡150å‡20å…ƒï¼ŒæŠ˜åŽÂ¥179
- æµ…å”‡ä¸“ç”¨å£çº¢Lï¼šæ»¡200å‡30å…ƒï¼ŒæŠ˜åŽÂ¥229
- å¤å¤çº¢å£çº¢Iï¼šæ»¡250å‡40å…ƒï¼ŒæŠ˜åŽÂ¥249

çœ‹ä¸Šå“ªä¸€æ¬¾å‘€ï¼ŸðŸ˜Š
```

#### åœºæ™¯2ï¼šå•†å“å¯¹æ¯”ä¸Žä¸‹å•å¼•å¯¼
```
ç”¨æˆ·ï¼šå£çº¢Kå’ŒLå“ªä¸ªå¥½
å°æ™ºï¼š| å•†å“ | ä»·æ ¼ | é€‚åˆåœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
| --- | --- | --- | --- | --- |
| æ»‹æ¶¦ä¿æ¹¿å£çº¢K | Â¥199 | å¹²ç‡¥å”‡éƒ¨ | ä¿æ¹¿ä¸å¡çº¹ï¼Œæ€§ä»·æ¯”é«˜ | è‰²å·ä»…3æ¬¾ |
| æµ…å”‡ä¸“ç”¨å£çº¢L | Â¥259 | æµ…å”‡/å¹²ç‡¥å”‡éƒ¨ | æ˜¾è‰²è‡ªç„¶ï¼Œä¿æ¹¿åŠ›å¼º | ç•¥æ²¾æ¯ |

æ€»ç»“ï¼šé¢„ç®—æœ‰é™é€‰Kï¼Œè¿½æ±‚æ˜¾è‰²é€‰Lï½žéœ€è¦é”å®šå…¶ä¸­ä¸€æ¬¾ä¼˜æƒ å—ï¼ŸðŸ˜Š

ç”¨æˆ·ï¼šé€‰å£çº¢L
å°æ™ºï¼šå¥½çš„ï½žæµ…å”‡ä¸“ç”¨å£çº¢LæŠ˜åŽÂ¥229ï½žæ˜¯å¦å¸®ä½ é”å®šä¼˜æƒ å¹¶è·³è½¬ä¸‹å•å‘€ï¼ŸðŸ˜Š

ç”¨æˆ·ï¼šéœ€è¦ï¼ŒåŠ è´­å¸å¦†æ°´
å°æ™ºï¼šå¥½çš„ï½žåŠ è´­æ­é…å¸å¦†æ°´åŽç»„åˆæ€»ä»·Â¥229+78=307å…ƒï½ž
çŽ°åœ¨ä¸€å¹¶ç»“ç®—å—ï¼Ÿå¸®ä½ è·³è½¬ï½ž
```

## æ•°æ®é›†è¯´æ˜Ž
### å•†å“æ•°æ®æ ¼å¼ï¼ˆdata/product_data.csvï¼‰
| å­—æ®µ | è¯´æ˜Ž | ç¤ºä¾‹ |
|------|------|------|
| product_id | å•†å“å”¯ä¸€æ ‡è¯† | 1011 |
| name | å•†å“åç§° | æ»‹æ¶¦ä¿æ¹¿å£çº¢K |
| category | å•†å“ç±»ç›®ï¼ˆå­å“ç±»ï¼‰ | ç¾Žå¦†-å£çº¢ |
| price | å•†å“åŽŸä»·ï¼ˆå…ƒï¼‰ | 199 |
| budget_range | é¢„ç®—åŒºé—´ | 100-200 |
| suitable_for | é€‚é…åœºæ™¯/è‚¤è´¨ | å¹²ç‡¥å”‡éƒ¨ |
| parameters | æ ¸å¿ƒå‚æ•° | ä¿æ¹¿è´¨åœ°ï¼ŒæŒä¹…6å°æ—¶ï¼Œæµ…å”‡é€‚é… |
| advantages | å•†å“ä¼˜ç‚¹ | ä¿æ¹¿ä¸å¡çº¹ï¼Œé€‚åˆæµ…å”‡ |
| disadvantages | å•†å“ç¼ºç‚¹ | è‰²å·è¾ƒå°‘ï¼ˆ3è‰²ï¼‰ |
| coupon_id | ä¼˜æƒ åˆ¸ID | C011 |
| coupon_amount | ä¼˜æƒ é‡‘é¢ï¼ˆå…ƒï¼‰ | 20 |
| coupon_condition | ä¼˜æƒ åˆ¸ä½¿ç”¨æ¡ä»¶ | æ»¡150å¯ç”¨ |

### æ•°æ®æ‰©å±•æŒ‡å—
æ–°å¢žå“ç±»ï¼ˆå¦‚å¦†å‰ä¹³ã€å¸å¦†æ°´ï¼‰ä»…éœ€ï¼š
1. åœ¨ `product_data.csv` ä¸­æŒ‰ä¸Šè¿°å­—æ®µæ·»åŠ å•†å“æ•°æ®
2. åœ¨ `agent.py` çš„ `search_products` å‡½æ•°ä¸­æ–°å¢žå­å“ç±»åŒ¹é…ï¼ˆå¦‚â€œå¦†å‰ä¹³â€â†’â€œç¾Žå¦†-å¦†å‰ä¹³â€ï¼‰
3. æ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘ï¼ŒAgentè‡ªåŠ¨é€‚é…æ–°å“ç±»

## æŠ€æœ¯ç»†èŠ‚
### 1. ä¼šè¯è®°å¿†ç®¡ç†
åŸºäºŽLangChainçš„ `ConversationBufferMemory` å®žçŽ°ï¼Œè®°ä½ç”¨æˆ·åŽ†å²è¾“å…¥ï¼ˆå¦‚é¢„ç®—ã€è‚¤è´¨ï¼‰ï¼Œé¿å…é‡å¤è¿½é—®ï¼Œæå‡å¯¹è¯æµç•…åº¦ã€‚

### 2. å·¥å…·è°ƒç”¨é€»è¾‘
- è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·è¾“å…¥åŒ…å«ã€ŒæŽ¨èã€å¯¹æ¯”ã€å“ªä¸ªå¥½ã€ä¼˜æƒ åˆ¸ã€ç­‰å…³é”®è¯
- è°ƒåº¦æµç¨‹ï¼šAgentè§£æžéœ€æ±‚â†’è°ƒç”¨å¯¹åº”å·¥å…·â†’æ•´åˆç»“æžœâ†’ç”Ÿæˆå›žå¤
- å®¹é”™æœºåˆ¶ï¼šå·¥å…·è°ƒç”¨å¤±è´¥æ—¶è¿”å›žå‹å¥½æç¤ºï¼Œä¸ä¸­æ–­å¯¹è¯æµç¨‹

### 3. é˜²æ¨¡åž‹å¹»è§‰è®¾è®¡
- æ•°æ®çº¦æŸï¼šPromptå¼ºåˆ¶æ¨¡åž‹ä»…ä½¿ç”¨CSVä¸­çš„å•†å“ä¿¡æ¯
- æ ¼å¼é™åˆ¶ï¼šå›žå¤æ¨¡æ¿å›ºå®šï¼Œé¿å…æ¨¡åž‹ç¼–é€ å¤–éƒ¨å“ç‰Œ/ä»·æ ¼
- æ— åŒ¹é…å¤„ç†ï¼šæ˜Žç¡®æç¤ºâ€œæœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å•†å“â€ï¼Œä¸å†—ä½™æŽ¨è

## æ‰©å±•æ–¹å‘
1. ðŸ›’ å¯¹æŽ¥çœŸå®žç”µå•†APIï¼ˆå¦‚æ·˜å®/äº¬ä¸œå¼€æ”¾å¹³å°ï¼‰ï¼Œæ›¿æ¢æ¨¡æ‹Ÿæ•°æ®
2. ðŸ–¼ï¸ å¤šæ¨¡æ€èƒ½åŠ›ï¼šæ·»åŠ å•†å“å›¾ç‰‡è¯†åˆ«æŽ¨èï¼ˆåŸºäºŽCLIPæ¨¡åž‹ï¼‰
3. ðŸ“Š ç”¨æˆ·ç”»åƒé›†æˆï¼šåŸºäºŽåŽ†å²è´­ä¹°è®°å½•ä¼˜åŒ–æŽ¨èç­–ç•¥
4. ðŸ“± å¤šæ¸ é“é€‚é…ï¼šæ”¯æŒæŠ–éŸ³/å°çº¢ä¹¦ç­‰å¹³å°çš„å¯¼è´­è¯æœ¯é£Žæ ¼
5. ðŸ¤– æ™ºèƒ½å®¢æœé›†æˆï¼šæ–°å¢žå”®åŽé—®é¢˜è‡ªåŠ¨è§£ç­”æ¨¡å—

## ä¾èµ–æ¸…å•
æ ¸å¿ƒä¾èµ–å·²æ•´ç†è‡³ `requirements.txt`ï¼ŒåŒ…å«ï¼š
```
langchain==0.1.19
langchain-dashscope==0.1.8
dashscope==1.14.1
streamlit>=1.30.0
pandas>=2.1.0
numpy>=1.26.0
neo4j>=5.18.0
python-dotenv>=1.0.0
retrying>=1.3.4
```
